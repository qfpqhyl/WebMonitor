name: webmonitor
services:
  # 后端服务
  backend:
    build:
      context: backend
      dockerfile: Dockerfile
    container_name: webmonitor-backend
    restart: unless-stopped
    environment:
      # 数据库配置 - 使用SQLite
      DATABASE_URL: sqlite:///./data/webmonitor.db

      # JWT配置
      SECRET_KEY: ${SECRET_KEY:-your_very_secure_secret_key_change_in_production}
      ALGORITHM: HS256
      ACCESS_TOKEN_EXPIRE_MINUTES: 30

      # 监控配置
      DEFAULT_CHECK_INTERVAL: 300
      MAX_CHECK_INTERVAL: 86400
      MIN_CHECK_INTERVAL: 10
      SELENIUM_HEADLESS: "true"
      SELENIUM_TIMEOUT: 30

      # 应用配置
      DEBUG: ${DEBUG:-false}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
      BACKEND_CORS_ORIGINS: http://localhost:3000,http://webmonitor-frontend:3000

      # 默认管理员账户
      ADMIN_USERNAME: ${ADMIN_USERNAME:-admin}
      ADMIN_PASSWORD: ${ADMIN_PASSWORD:-admin123}
      ADMIN_EMAIL: ${ADMIN_EMAIL:-admin@webmonitor.com}

    ports:
      - "8000:8000"
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8000/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - webmonitor-network

  # 前端服务
  frontend:
    build:
      context: frontend
      dockerfile: Dockerfile
    container_name: webmonitor-frontend
    restart: unless-stopped
    ports:
      - "3000:3000"
    depends_on:
      backend:
        condition: service_healthy
    healthcheck:
      test: [ "CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3000" ]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - webmonitor-network

networks:
  webmonitor-network:
    driver: bridge
